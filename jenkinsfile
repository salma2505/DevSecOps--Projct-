pipeline {
  agent any

  environment {
    COMPOSE_FILE = 'docker_compose.yml'
  }

  stages {
    stage('Pull Latest Images') {
      steps {
        echo 'ğŸ“¥ Pulling images from registry...'
        sh '''
          docker pull postgres:latest
          docker pull salma2505/incidentshield:latest
        '''
      }
    }

    stage('Start with Docker Compose') {
      steps {
        echo 'ğŸš€ Launching services with docker-compose...'
        sh 'docker-compose up -d'
      }
    }

    stage('Smoke Test') {
      steps {
        echo 'ğŸ” Testing app endpoint...'
        sh 'curl -s http://localhost:5000 || echo "âš ï¸ App may not be responding."'
      }
    }
  }

  post {
    always {
      echo 'ğŸ§¹ Shutting down services...'
      sh 'docker-compose down'
    }
  }
}

